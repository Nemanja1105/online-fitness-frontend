<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="card p-0 rounded-4">
                <img [src]="showImage()" class="card-img-top central-image img-fluid" alt="...">
                <div class="card-body p-3 p-md-4">
                    <div class="card-title m-0">
                        <div class="d-flex flex-column flex-sm-row  justify-content-between align-items-center">
                            <div class="d-flex  align-items-center gap-2">

                                <h1 class="m-0">{{program?.name}}</h1>

                                <span class="badge fs-6 p-2" [ngClass]="{'text-bg-success':program?.difficulty==='Beginner',
                                'text-bg-warning':program?.difficulty==='Intermediate',
                                'text-bg-danger':program?.difficulty==='Expert'
                            
                            }">{{program?.difficulty}}</span>
                            </div>
                            <div class="d-flex flex-column flex-md-row mt-2 mt-md-0 align-items-center gap-2">
                                @if( clientId && !isParticipating && program?.client?.id!==clientId){
                                <a [routerLink]="['/subscribe',program?.id]" matTooltip="Participate to fitness program"
                                    class="btn btn-outline-primary fw-semibold fs-5 textImageCenter">Participation
                                    <img src="../../assets/subscribeIcon.png" /></a>
                                }
                                @if(clientId && program?.client?.id!==clientId ){
                                <a matTooltip="Send question to advisor" (click)="openDialog(program)"
                                    class="btn btn-outline-warning fw-semibold fs-5 textImageCenter">Ask advisor<img
                                        src="../../assets/askIcon.png" /></a>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="fw-semibold fs-5 text-secondary textImageCenter gap-1">
                        {{program?.categoryName}}<img src="../../assets/approvedIcon.png" /></div>
                    <hr class="mt-0" />
                    <ul class="nav mt-sm-2  nav-pills nav-tabs mt-2">
                        <li class="nav-item">
                            <a data-bs-toggle="tab" data-bs-target="#details-tab-pane"
                                class="nav-link active fw-semibold fs-6 textImageCenter " aria-current="page">Basic
                                details<img src="../../assets/detailsIcon.png" /></a>
                        </li>
                        <li class="nav-item ">
                            <a data-bs-toggle="tab" data-bs-target="#comments-tab-pane"
                                class="nav-link fw-semibold fs-6 textImageCenter">Comments<img
                                    src="../../assets/commentsIcon.png" /></a>
                        </li>
                        @if(clientId && (isParticipating || program?.client?.id===clientId)){
                        <li class="nav-item">
                            <a data-bs-toggle="tab" data-bs-target="#start-tab-pane"
                                class="nav-link fw-semibold fs-6 textImageCenter">Let's start<img
                                    src="../../assets/startIcon.png" /></a>
                        </li>
                        }
                    </ul>
                    <div class="tab-content mt-2" id="myTabContent">
                        <div class="tab-pane fade show active" id="details-tab-pane" role="tabpanel"
                            aria-labelledby="home-tab" tabindex="0">

                            <div class="container mt-4">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="fs-4 fw-semibold">Program details</div>
                                        <hr class="m-0 w-100 d-sm-none">
                                        <hr class="m-0 w-25 d-sm-block">
                                        <div class="container mt-2">

                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="fs-5 fw-semibold textImageCenter">Price<img
                                                            src="../../assets/moneyIcon.png">
                                                    </div>
                                                    <p class="text-secondary">{{program?.price}} KM</p>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="fs-5 fw-semibold textImageCenter">Duration<img
                                                            src="../../assets/durationProfileIcon.png">
                                                    </div>
                                                    <p class="text-secondary">{{program?.duration}} days</p>
                                                </div>

                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="fs-5 fw-semibold textImageCenter">Difficulty<img
                                                            src="../../assets/dificultyIcon.png"
                                                            style="width:24px; height: 24px;">
                                                    </div>
                                                    <p class="text-secondary">{{program?.difficulty}}</p>
                                                </div>

                                                <div class="col-md-3">
                                                    <div class="fs-5 fw-semibold textImageCenter">Category<img
                                                            src="../../assets/approvedIcon.png">
                                                    </div>
                                                    <p class="text-secondary">{{program?.categoryName}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="fs-4 fw-semibold">Instructor details</div>
                                        <hr class="m-0 w-100 d-sm-none">
                                        <hr class="m-0 w-25 d-sm-block">
                                        <div class="container mt-2">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="fs-5 fw-semibold textImageCenter">Name<img
                                                            src="../../assets/nameIcon.png"
                                                            style="width:24px; height: 24px;">
                                                    </div>
                                                    <p class="text-secondary">{{program?.instructorName}}</p>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="fs-5 fw-semibold textImageCenter">Surname<img
                                                            src="../../assets/surnameIcon.png"
                                                            style="width:24px; height: 24px;">
                                                    </div>
                                                    <p class="text-secondary">{{program?.instructorSurname}}</p>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="fs-5 fw-semibold textImageCenter">Contact<img
                                                            src="../../assets/contactIcon.png"
                                                            style="width:24px; height: 24px;">
                                                    </div>
                                                    <p class="text-secondary">{{program?.instructorContact}}</p>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class=" mt-3 card-title fs-4 fw-semibold textImageCenter">
                                            Description<img src="../../assets/descIcon.png">
                                        </div>

                                        <p class="text-secondary ">{{program?.description}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="comments-tab-pane" role="tabpanel" aria-labelledby="home-tab"
                            tabindex="0">
                            <div class="container mt-4">
                                <div class="row">
                                    @if(clientId){
                                    <div class="d-flex justify-content-end">
                                        <button data-bs-toggle="collapse" href="#commentCollapse"
                                            class="btn btn-primary fw-semibold fs-6 textImageCenter"
                                            matTooltip="Comment fitness program">{{program?.client?.id===clientId?'Reply':'Comment'}}<img
                                                src="../../assets/commentsIcon.png"
                                                style="height: 24px; width: 24px;" /></button>
                                    </div>
                                    }
                                    <div class="collapse mt-3 rounded-4" id="commentCollapse">
                                        <div class="card card-body">

                                            <div class="mb-2">
                                                <label for="descriptionInput" class="fw-semibold">Comment</label>
                                                <div class="input-group">
                                                    <span class="input-group-text" id="addon-wrapping"><img
                                                            src="../../assets/descriptionIcon.jpeg" /></span>
                                                    <textarea [formControl]="comment" class="form-control " rows="2"
                                                        id="descriptionInput" placeholder="Enter comment"
                                                        name="description" (blur)="onBlur(comment)"
                                                        [ngClass]="{ 'is-invalid': (comment.dirty || comment.touched) && comment.invalid }">
                                                        </textarea>
                                                </div>
                                                @if(comment.invalid && (comment.dirty ||
                                                comment.touched)){
                                                <div class="text-danger">
                                                    Comment is required!
                                                </div>
                                                }

                                            </div>
                                            <button class="btn btn-success fw-semibold" [disabled]="comment.invalid"
                                                (click)="saveComment()">Save comment</button>

                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3 gy-3">
                                    @for (item of comments; track $index) {
                                    <div class="card rounded-4">
                                        <div class="card-body">
                                            <div class="d-flex gap-3 align-items-center">

                                                <img [src]="showImageById(item)" style=" height: 40px; width: 40px;"
                                                    alt="Avatar" class="img-fluid rounded-circle">
                                                <div class="fs-5 fw-semibold">{{item.sender.name}}
                                                    {{item.sender.surname}}</div>
                                                <div class="text-secondary fw-semibold">
                                                    {{getFormattedTime(item.createdAt)}}</div>
                                                @if(item.fitnessProgramClientId===item.sender.id){
                                                <span class="badge text-bg-danger p-2">Owner</span>
                                                }

                                            </div>
                                            <div class="fs-6 mt-1">{{item.comment}}</div>
                                        </div>
                                    </div>
                                    }





                                </div>
                            </div>

                        </div>
                        <div class="tab-pane fade" id="start-tab-pane" role="tabpanel" aria-labelledby="home-tab"
                            tabindex="0">
                            <div class="container mt-4">
                                <div class="row">
                                    <div class="fs-4 fw-semibold">Workout details</div>
                                    <hr class="m-0 w-100 d-sm-none">
                                    <hr class="m-0 w-25 d-sm-block">
                                    <div class="container mt-2">
                                        <div class="row">
                                            @for (item of program?.attributes; track $index) {

                                            <div class="col-md-4">
                                                <div class="fs-5 fw-semibold textImageCenter">
                                                    {{item?.attributeName}}<img src="../../assets/attributeIcon.png">
                                                </div>
                                                <p class="text-secondary">{{item?.value}} </p>
                                            </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="fs-4 fw-semibold">Program</div>
                                    <hr class="m-0 w-100 d-sm-none">
                                    <hr class="m-0 w-25 d-sm-block">
                                    <div class="container mt-2">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <button data-bs-toggle="collapse" href="#collapse"
                                                    class="btn btn-outline-success fs-5 fw-semibold textImageCenter">Start
                                                    workout
                                                    <img src="../../assets/startIcon.png"
                                                        style="width: 24px; height: 24px;" /></button>

                                            </div>
                                        </div>
                                        <div class="row mt-4">
                                            <div class="collapse w-100" id="collapse">
                                                <div class="card w-100 card-body ">
                                                    @if(program?.location=='Gym' || program?.location=="Park"){
                                                    <div class="d-flex justify-content-center">
                                                        <div>
                                                            <p class="fw-semibold fs-3 textImageCenter m-0">See you at
                                                                the
                                                                location<img src="../../assets/locationNewIcon.png" />
                                                            </p>
                                                            <p class="fs-5 text-secondary m-0">
                                                                "{{program?.linkAddress}}"
                                                            </p>
                                                        </div>
                                                    </div>
                                                    }
                                                    @else {
                                                    <iframe height="695" [src]="youtube"
                                                        title="How to deadlift like a world champion powerlifter"
                                                        frameborder="0"
                                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                                        allowfullscreen></iframe>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>